<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>touch 碰撞 test</title>
</head>
<body>
    <canvas id="canvas" tabindex="0" width="500" height="500"></canvas>
    <script src="../../basics/basics.js"></script>
    <script src="../Math2d.js"></script>
    <script src="../visual.js"></script>
    <script src="../canvasTGT.js"></script>
    <script src="../Sprites.js"></script>

    <script type="text/javascript">
    var s=new Sprites(10,10,"./SpritesMap.png");
        var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");
        
        var ctrlTGT=new CanvasPolygonTGT();
            ctrlTGT.data=new Polygon([
                {x:100,y:100},
                {x:50,y:100},
                {x:100,y:50}
            ]);
        
        // var ctrlTGT=new CanvasRectTGT(0,0,20,20);
            ctrlTGT.setTransformMatrix(createMatrix2x2T().translate(200,200));
            
        // var staticTGT1 = ctrlTGT.copy();
        var staticTGT1 = new CanvasRectTGT(0,0,50,50);
        
        staticTGT1.setTransformMatrix(createMatrix2x2T().translate(200,400));
        var staticTGT2 = new CanvasRectTGT(0,0,50,500);
        // canvas 弧形 弧度 从x正方向为 0
        var staticTGT3 = new CanvasArcTGT(400,400,50,0,180*Math.DEG);

        staticTGT1.fillStyle="#ff0";
        // staticTGT1.fillStyle=staticTGT1.createSpritesFillStyle(s,2,2,1,1);
        staticTGT2.fillStyle="#f00";
        staticTGT3.fillStyle="#f00";
        ctrlTGT.fillStyle="#adf";

        var staticTGTs=[
        staticTGT1,
        staticTGT2,
        staticTGT3
        ];
        staticTGT1.want_to_closePath=true
        staticTGT2.want_to_closePath=true
        staticTGT3.want_to_closePath=true
        function renderTGTs(){
            ctx.clearRect(0,0,500,500);
            staticTGT1.render(ctx);
            staticTGT2.render(ctx);
            staticTGT3.render(ctx);
            ctrlTGT.render(ctx);
        }


        addKeyEvent(canvas,1,38,function(e){
            ctrlTGT.setTransformMatrix(ctrlTGT.transformMatrix.translate(0,-2));
            var i=0;
            for(;i<staticTGTs.length;++i){
                if(CanvasTGT.isTouch(ctrlTGT,staticTGTs[i])){
                    console.log("is touching ",staticTGTs[i]);
                }
            }
            renderTGTs()
        });
        
        addKeyEvent(canvas,1,40,function(e){
            ctrlTGT.setTransformMatrix(ctrlTGT.transformMatrix.translate(0,2));
            var i=0;
            for(;i<staticTGTs.length;++i){
                if(CanvasTGT.isTouch(ctrlTGT,staticTGTs[i])){
                    console.log("is touching ",staticTGTs[i]);
                }
            }
            renderTGTs()
        });
        
        addKeyEvent(canvas,1,39,function(e){
            ctrlTGT.setTransformMatrix(ctrlTGT.transformMatrix.translate(2,0));
            var i=0;
            for(;i<staticTGTs.length;++i){
                if(CanvasTGT.isTouch(ctrlTGT,staticTGTs[i])){
                    console.log("is touching ",staticTGTs[i]);
                }
            }
            renderTGTs()
        });
        
        addKeyEvent(canvas,1,37,function(e){
            ctrlTGT.setTransformMatrix(ctrlTGT.transformMatrix.translate(-2,0));
            var i=0;
            for(;i<staticTGTs.length;++i){
                if(CanvasTGT.isTouch(ctrlTGT,staticTGTs[i])){
                    console.log("is touching ",staticTGTs[i]);
                }
            }
            renderTGTs()
        });
        renderTGTs();

        canvas.addEventListener("click",function(e){
            var x=e.clientX,y=e.clientY;
            var i=0;
            for(;i<staticTGTs.length;++i){
                if(staticTGTs[i].isInside(x,y)){
                    console.log("is click staticTGTs!",staticTGTs[i]);
                }
            }
        })
    </script>
</body>
</html>